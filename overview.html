<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>NUTS JSON overview</title>
	<style>
		body { font-family: "Myriad Pro", Myriad, MyriadPro-Regular, 'Myriad Pro Regular', MyriadPro, 'Myriad Pro', "Liberation Sans", "Nimbus Sans L", "Helvetica Neue", vegur, Vegur, Helvetica, Arial, sans-serif; }
		#bck { fill: #f5f5f5; }
		.cntrg { fill: lightgray; }
		.cntbn { fill: none; stroke: white; stroke-linecap:round; stroke-linejoin:round }
		.rg { fill: #004494; }
		.rg:hover { fill: darkred; }
		.bn { fill: none; stroke-linecap:round; stroke-linejoin:round }
		.bn_0 { stroke: #fff; stroke-width: 1.5px; }
		.bn_1 { stroke: #ddd; stroke-width: 1px; }
		.bn_2 { stroke: #ddd; stroke-width: 1px; }
		.bn_3 { stroke: #888; stroke-width: 0.5px; }
		.bn_oth { stroke: #444; stroke-width: 1px; }
		.infoText { font-size: 13px; }

		#info {
			opacity: 0;
			position: absolute;
			padding: 5px;
			width: 150px;
			background: white;
			border: 0px;
			border-radius: 5px;
			font: 14px;
			pointer-events: none;
			box-shadow: 5px 5px 5px grey;
		}

	</style>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://d3js.org/topojson.v1.min.js"></script>
	<script src="https://rawgit.com/jgaffuri/EurostatVisu/gh-pages/js/lib.js"></script>

</head>

<body>
<svg id="map"></svg>
<div id="info"></div>

<script>
	//http://bl.ocks.org/mbostock/5557726

	//get url parameters for projection, level and size
	var proj = EstLib.getParameterByName("proj") || "laea",
			nutsLvl = EstLib.getParameterByName("lvl") || "2",
			size = EstLib.getParameterByName("s") || 800,

	//build svg
			app = 0.87,
			svg = d3.select("#map").attr("width", size).attr("height", size*app),
	//background rectangle
			bckRect = svg.append("rect").attr("id","bck").attr("x",0).attr("y",0).attr("width", size).attr("height", size),
	//drawing group
			g = svg.append("g").attr("transform","translate(0,"+(-(size*45)/700)+")"),
	//text
			infoText = svg.append("text").attr("x",5).attr("y",20).attr("class","infoText");

	//path function
	path = d3.geoPath().projection(null),
		//info
			infoDiv = d3.select("#info")
	;

	//get data
	d3.json("json/topojson/"+proj+"/"+size+"px/NUTS_lvl"+nutsLvl+".json", function(error, nuts) {
		if (error) return console.error(error);

		g.append("g").selectAll("path").data(topojson.feature(nuts, nuts.objects.cntrg).features).enter()
				.append("path").attr("d", path)
				.attr("class", "cntrg");

		g.append("g").selectAll("path").data(topojson.feature(nuts, nuts.objects.cntbn).features).enter()
				.append("path").attr("d", path)
				.attr("class", "cntbn");

		g.append("g").selectAll("path").data(topojson.feature(nuts, nuts.objects.nutsrg).features).enter()
				.append("path").attr("d", path)
				.attr("class", "rg")
				.on("mouseover", function(d) {
					infoDiv.html(d.properties.na+"<br>"+d.properties.id)
							.style("left", (d3.event.pageX+30) + "px").style("top", (d3.event.pageY-20) + "px")
							.transition().duration(200).style("opacity",1);
				})
				.on("mouseout", function() {
					infoDiv.transition().duration(200).style("opacity",0);
				});

		var bn = topojson.feature(nuts, nuts.objects.nutsbn).features;
		bn.sort(function(bn1,bn2){ return bn2.properties.lvl - bn1.properties.lvl; });
		g.append("g").selectAll("path").data(bn).enter()
				.append("path").attr("d", path)
				.attr("class", function(bn){
					bn = bn.properties;
					//eu=EU_FLAG,efta=EFTA_FLAG,cc=CC_FLAG,lvl=STAT_LEVL_,oth=OTHR_CNTR_
					var cl = ["bn","bn_"+bn.lvl];
					if(bn.oth==="T") cl.push("bn_oth");
					return cl.join(" ");
				});

		//zoom behaviour
		/*svg.append("rect").attr("width", size).attr("height", size).style("fill", "none").style("pointer-events", "all")
		 g.call(d3.zoom().scaleExtent([1,4]).on("zoom", function(){
		 console.log(this);
		 console.log(d3.event.transform);
		 tr = d3.event.transform;
		 g.attr("transform", d3.event.transform);
		 }));*/

	});

</script>
</body>
